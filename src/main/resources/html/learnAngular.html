<!DOCTYPE html>
<html>
<script src="static/angular.min.js">
</script>
<body>
<div ng-app="myApp" ng-controller="myCtrl">
    <h1>Receiving push msg: "{{msg}}"</h1>

    <p><textarea ng-model="searchText" cols="40" rows="10"></textarea></p>

    <p>Number of characters: <span>{{numberOfChars}}</span></p>
    <p><span>{{searchResult}}</span></p>
</div>

<script>
    var app = angular.module('myApp', []);

    app.controller('myCtrl', function($scope,$http) {
        $scope.msg = {};
        $scope.searchText = "";
        $scope.numberOfChars = 0;
        $scope.searchResult = "";


        $scope.$watch('searchText', function() {
            $scope.numberOfChars = $scope.searchText.length;
            counter = $scope.numberOfChars;
            if (counter > 1) {
                console.log("search!");
                $http.get("search/"+$scope.searchText)
                        .then(function(response) {
                            console.log("Searched for: " + response.data);
                            $scope.searchResult = response.data;
                        });

            } else {
                $scope.searchResult = "";
            }
        });

        // handles the callback from the received event
        var handleCallback = function (msg) {
            $scope.$apply(function () {
                $scope.msg = msg.data;
            });
        }

        var source = new EventSource('subscribe');
        source.addEventListener('counter', handleCallback, false);

    });
</script>
</body>
</html>